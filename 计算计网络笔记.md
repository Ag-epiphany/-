# 目录

[toc]

# 因特网概述

## 网络，互联网和因特网的区别与联系※

1. 网络是由若干结点和链接这些结点的链路组成
2. 多个网络通过路由器互连起来，构成一个覆盖范围更大的网路，称为互联网
3. 因特网是世界上最大的互联网络，连接在因特网上的计算机称为主机
   ![image-20230712103755727](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712103755727.png)

## internet和Internet的区别

1. internet(互联网或互连网)是一个通用名词，它泛指由多个计算机网络互
   连而成的网络。在这些网络之间的通信协议可以是任意的。
2. Internet(因特网)则是一个专用名词，它指当前全球最大的、开放的、由
   众多网络相互连接而成的特定计算机网络，它采用TCPP协议族作为通信的
   规则，其前身是美国的ARPANET。

## 因特网服务提供者ISP(Internet Service Provider)

> 通过向ISP缴纳费用，拿到IP地址和通信线路，路由器等连网设备的使用权
>
> 同时，每个接入因特网的用户，也可以成为ISP，只需购买调制解调器或路由器这样的设备，让其他用户与之相连

![image-20230712104747662](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712104747662.png)

## 基于ISP的三层结构的因特网

![image-20230712105125696](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712105125696.png)

## 因特网的标准化工作

1. 因特网的标准化工作对因特网的发展起到了非常重要的作用。

2. 因特网在制定其标准上的一个很大的特点是面向公众。

   1. 因特网所有的[RFC(Request For Comments)技术文档](http://www.ietf.org/rfc.html)都可从因特网上免费下载；
   2. 任何人都可以随时用电子邮件发表对某个文档的意见或建议。

3. 因特网协会ISOC是一个国际性组织，它负责对因特网进行全面管理，以及在世界范围内促进其发展和使用。

   1. 因特网体系结构委员会IAB,负责管理因特网有关协议的开发：

   2. 因特网工程部ETF，负责研究中短期工程问题，主要针对协议的开发和标准化

   3. 因特网研究部IRTF,从事理论方面的研究和开发一些需要长期考虑的问题。
      制订因特网的正式标准要经过以下4个阶段：

      1. 因特网草案（在这个阶段还不是RFC文档）
      2. 建议标准（从这个阶段开始就成为RFC文档）
         因特网体系结构委员会A由
      3. 草案标准
      4. 因特网标准

      > 只有一小部分RFG文档最后才能变成因特网标准

   ![image-20230712110032575](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712110032575.png)

## 因特网的组成※

1. 边缘部分

   > 由所有连接在因特网上 的主机组成。这部分是用户直接使用的，用来进行通信
   > （传送数据，音频或视频)和资源共享。

2. 核心部分

   > 由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）

   1. 路由器是实现分组交换的关键构件，任务是转发收到的分组

# 三种交换方式

## 电路交换(Circuit Switching)

> 电话交换机接通电话线的方式称为电路交换
> 从通信资源的分配角度来看，交换(Switching)就是按照某种方式动态地分配传输线路的资源；
> 不适合计算机传输数据，因为占用通信资源，却迟迟不使用，造成通信资源的浪费

1. 电话交换的三个步骤
   1. 建立连接（分配通信资源）
   2. 通话（一直占用通信资源）
   3.  释放连接（归还通信资源）
2. 优点
   1. 通信时延小
   2. 有序传输
   3. 没有冲突
   4. 适用范围广
   5. 实时性强
   6. 控制简单
3. 缺点
   1. 建立连接时间长
   2. 线路独占，使用效率低
   3. 灵活性差
   4. 难以规格化

## 分组交换(Packet Switching)※

> 通常把表示消息的整块数据称为一个报文

1. 步骤

   1. 发送方
      构造分组，发送分组

   2. 路由器
      缓存分组，转发分组

   3. 接收方

      接收分组，还原报文

2. 优点

   1. 无需建立连接
   2. 线路利用率高
   3. 简化了存储管理
   4. 加速传输
   5. 减少出错概率和重发数据量

3. 缺点

   1. 引起了转发时延

   2. 需要传输额外的信息量

   3. 对于数据报服务，存在失序、丢失或重复分组的问题;

      对于虚电路服务存在呼叫建立、数据传输和虚电路释放三个过程

## 报文交换(Message Switching)

> 与分组交换类似，但对报文大小没有限制，也不分组，现代已很少使用该方法

1. 优点
   1. 无需建立连接
   2. 动态分配线路
   3. 提高线路可靠性
   4. 提高线路利用率
   5. 提供多目标服务

2. 缺点
   1. 引起了转发时延
   2. 需要较大存储缓存空间
   3. 需要传输额外的信息量

# 计算机网络的定义和分类

## 定义

1. 简单定义：一些**互相连接**的，**自治**的计算机的**集合**

   > 互连：是指计算机之间可以通过有线或无线的方式进行数据通信
   > 自治：是指独立的计算机，它有自己的硬件和软件，可以单独运行使用
   > 集合: 是指至少需要两台计算机

2. 计算机网络的较好的定义

   > 计算机网络主要是由一些通用的、可编程的硬件互连而成的，
   >  而这些硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号)。
   >  这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。

    1. 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智能手机等智能硬件
    1. 计算机网络并非专门用来传送数据，而是能够支持很多种的应用（包括今后可能出现的名种应用)


## 分类

1. 按交换技术分类
   1. 电路交换网路
   2. 报文交换网络
   3. 分组交换网络

2. 按使用者分类

   1. 公用网

      > 电信公司出资建造,给电信公司缴纳费用即可使用

   2. 专用网

      > 不向外人提供服务

3. 按传输介质分类

   1. 有线网路

      > 包括双绞线网络,光纤网络等

   2. 无线网络

      > WIFI应用普遍

4. 按覆盖范围分类

   1. 广域网(WAN)

      > 可以覆盖一个国家,地区甚至几个洲
      >
      > WAN是因特网的核心部分,为核心路由器提供远距离高速连接

   2. 城域网(MAN)

      > 覆盖一个街区,或几个城市
      >
      > 通常作为城市骨干网,互连学校,企业,机构的局域网

   3. 局域网(LAN)

      > 覆盖一个实验室,一幢楼,一个校园等
      >
      > 

   4. 个域网(PAN)

      > 即无线个人区域网(WPAN),在各人工作的地方,将属于个人使用的电子设备
      > 用无线技术连接起来的网络

5. 按拓扑结构分类

   1. 总线型网络
      ![image-20230712140101315](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712140101315.png)
   2. 星型网络
      ![image-20230712140145867](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712140145867.png)
   3. 环型网络

   ![image-20230712140251758](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712140251758.png)

   4. 网状型网络
      ![image-20230712140454142](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712140454142.png)

# 计算机网络的性能指标

|      指标       | 评测                                                         |
| :-------------: | :----------------------------------------------------------- |
|      速率       | 连接在计算机网络上的主机在数字信道上传送比特的速率，也称为比特率或数据率<br />bit/s（b/s，bps)，kb/s，Mb/s，Gb/s |
|      带宽       | 用来表示网络的通信线路所能传送数据的能力<br />因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据量”<br />与速率指标相同 |
|     吞吐量      | 吞吐量表示在单位时间内通过某个网络（或信道、接口）的数据量。<br/>吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。<br/>吞吐量受网络的带宽或额定速率的限制。 |
|      时延       | 网络时延由三部分组成，分别为发送时延，传播时延，处理时延<br />网卡的发送速率，信道带宽，交换机的接口速率共同决定了发送时延<br /><img src="https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712215350593.png" alt="image-20230712215350593" style="zoom: 80%;" /> |
|   时延带宽积    | 1. 若发送端连续发送数据，则在所发送的第一个比特即将到达终点时，<br />     发送端就已经发送了时延带宽积个比特。<br/>2. 链路的时延带宽积又称为以比特为单位的链路长度。 |
| 往返时间（RTT） | 双向交互一次所需的时间<br />从源主机发送分组开始，直到源主机收到来自目的主机的确认分组为止 |
|     利用率      | 分为信道利用率，网络利用率<br />信道利用率：表示某信道有百分之几的时间是被利用的<br />网络利用率：全网络的信道利用率加权平均<br />信道利用率并非越高越好，高利用率会引发高时延 |
|     丢包率      | 丢包率即分组丢失率，是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率。<br />丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等<br /> |

1. 补充

   1. 时延计算公式
      $$
      发送时延 = \frac{分组长度}{发送速率}\\\\
      传播时延 = \frac{信道长度}{电磁波传播速率}\\\\
      处理时延一般不计算
      $$

   

   2. 时延带宽积
      $$
      时延带宽积 = 传播时延 \times 带宽
      $$

   

   3. 网络当前时延与信道利用率之间的关系
      $$
      D为网络当前时延，D_0为网络空闲时的时延，U为信道利用率\\
      D = \frac{D_0}{1-U}
      $$
   
   4. 丢包率计算公式
      $$
      丢包率 = \frac{一定时间范围内丢失的分组数量}{总分组数量}
      $$
   
   5. 分组丢失的两种情况

      1. 分组在传输过程中出现误码，被结点丢弃
      2. 分组到达一台队列已满的分组交换机时被丢弃，在通信量较大时就可能造成网络拥塞。
   
      

   6. 丢包率反映了网络的拥塞情况

      1. 无拥塞时路径丢包率为0
      2. 轻度拥塞时路径丢包率为1%~4%
      3. 严重拥塞时路径丢包率为5%~15%
   
   7.  n个分组，m段链路，忽略处理时延，总时延的计算
      $$
      总时延 = n个分组的发送时延 + 1个分组的发送时延 \times (m-1) + 1段链路的传播时延 \times m\\
      （假设分组等长，各链路长度相同，带宽相同）
      $$
      

# 计算机网络体系结构

## 常见的计算机网络体系结构

1. OSI体系结构（开放系统互连参考模型）
2. TCP/IP体系结构

![image-20230712233155377](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712233155377.png)

![image-20230712233258928](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230712233258928.png)

![image-20230713141838351](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713141838351.png)

## 计算机网络体系结构分层的必要性

> "分层“可将庞大而复杂的问题，转化为若干较小的局部问题，而这些较小的局部问题就比较易于研究和处理。

|  体系结构  |                    解决问题                    |
| :--------: | :--------------------------------------------: |
|   应用层   | 解决通过应用进程的交互来实现特定网络应用的问题 |
|   表示层   |         解决通信双方交换信息的表示问题         |
|   会话层   |            解决进程之间进行会话问题            |
|   运输层   |         解决进程之间基于网络的通信问题         |
|   网络层   |    解决分组在多个网络上传输（路由）问题[^1]    |
| 数据链路层 |  解决分组在一个网络（或一段链路）上传输的问题  |
|   物理层   |        解决使用何种信号来传输比特的问题        |

![image-20230713141226704](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713141226704.png)

[^1]:表示层的任务是实现与数据表示相关的功能，主要包括数据字符集的转换、数据格式化、文本压缩、数据加密以及解密等工作。
## 计算机网络体系结构分层思想举例

<video src="计算机网络体系结构分层思想举例.mp4" />

## 计算机网络体系结构中的专用术语

|      术语       | 解释                                                         |
| :-------------: | :----------------------------------------------------------- |
|      实体       | 任何可发送或接收信息的硬件或软件进程                         |
|    对等实体     | 收发双方相同层次中的实体                                     |
|      协议       | 控制两个对等实体进行逻辑通信的规则的集合                     |
|   协议三要素    | 语法，语义，同步                                             |
|      语法       | 定义所交换信息的格式                                         |
|      语义       | 定义收发双方所要完成的操作                                   |
|      同步       | 定义收发双方的时序关系<br /><img src="https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713004509158.png" alt="image-20230713004509158" style="zoom:67%;" /> |
|      服务       | 在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务<br /><img src="https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713004720687.png" alt="image-20230713004720687" style="zoom: 50%;" /> |
|   服务访问点    | 在同一系统中相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型<br />1. 数据链路层的服务访问点为帧的“类型”字段。<br />2. 网络层的服务访问点为IP数据报首部中的“协议字段”。<br />3. 运输层的服务访问点为“端口号” |
|    服务原语     | 上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令称为服务原语 |
| 协议数据单元PDU | 对等层次之间传送的数据包称为该层的协议数据单元               |
| 服务数据单元SDU | 同一系统内，层与层之间交换的数据包称为服务数据单元<br />多个SDU可以合成为一个PDU；一个SDU也可划分为几个PDU |

1. 补充

   1. ![image-20230713003922041](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713003922041.png)

   2. ![image-20230713005515143](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713005515143.png)

   3. 协议是“水平的”，服务是“垂直的

   4. 实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。

      也就是说，下面的协议对上面的实体是"透明"的。

# 物理层

## 传输媒体

1. 导引型传输媒体
   1. 双绞线
   2. 同轴电缆
   3. 光纤
   4. 电力线
2. 非导引型传输媒体
   1. 微波通信（2~40GHz）
   2. 红外线
   3. 可见光

## 主要任务

> 1. 物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流。
> 2. 物理层为数据链路层屏蔽了各种传输媒体的差异，使数据链路层只需要考虑如何完成本层的协议
>    和服务，而不必考虑网络具体的传输媒体是什么。

1. 机械特性

   >  指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置

2. 电气特性

   > 指明在接口电缆的各条 线上出现的电压的范围。

3. 功能特性

   > 指明某条线上出现的某一电平的电压表示何种意义。

4. 过程特性

   > 指明对于不同功能的各种可能事件的出现顺序。

## 传输方式

![image-20230713180135786](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713180135786.png)

## 常用编码

> 码元
>
> > 在使用时间域的波形表示数字信号时代表不同离散数值的基本波形

![image-20230713182310202](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713182310202.png)

## 调制

#### 基本调制方法

![image-20230713182539088](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713182539088.png)

#### 混合调制方法

![image-20230713182509529](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230713182509529.png)

## 信道极限容量

> 在信道带宽一定的情况下，根据奈氏准则和香农公式，
> 要想提高信息的传输速率就必须采用多元制（更好的调制方法）和努力提高信道中的信噪比。
>
> 奈式准则
>
> > 理想低通信道的最高码元传输速率=2W Baud=2W(单位：码元/秒)
> > 理想带通信道的最高码元传输速率=W Baud=W(单位：码元/秒)
>
> 香农公式
>
> > $$
> > c = W \times log_2(1 + \frac{S}{N})\\
> > 单位:bit/s
> > $$

# 数据链路层

## 概述

> 数据链路层以帧为单位传输和处理数据。
>
> 链路 (Link)
>
> >  就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。
>
> 数据链路(Data Link)
>
> >  是指把实现通信协议的硬件和软件加到链路上，就构成了数据链路。

1. 使用点对点信道的数据链路层三个重要问题

   2. 封装成帧

   3. 差错检测

   4. 可靠传输

      > 尽管误码是不能完全避免的，但若能实现发送方发送什么接收方就能收到什么，就称为可靠传输。

2. 使用广播信道的数据链路层
   1. 共享式以太网的媒体接入控制协议CSMA/CD
   2. 802.11局域网的媒体接入控制协议CSMA/CA

3. 数据链路层的互连设备
   1. 网桥和交换机的工作原理
   2. 集线器(物理连接设备)与交换机的区别

## 封装成帧

> 封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧。
>
> 帧头和帧尾的作用之一就是帧定界.

![image-20230714001103934](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714001103934.png)

1. 透明传输

   > 数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。

   1. 面向字节的物理链路使用字节填充（或称字符填充）的方法实现透明传输
   2. 面向比特的物理链路使用比特填充的方法实现透明传输。

2. 考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，
   即最大传送单元MTU (Maximum Transfer Unit)

## 差错检测

> 实际的通信链路都不是理想的，比特在传输过程中可能会产生差错；
> 1可能会变成0，而0也可能变成1。这称为比特差错。
>
> 在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率BER(Bit Error Rate)。

1. 奇偶校验

   > 在待发送的数据后面添加1位奇偶校验位，
   > 使整个数据（包括所添加的校验位在内）中”1”的个数为奇数（奇校验）或偶数（偶校验）。
   >
   > > 1. 如果有奇数个位发生误码，则奇偶性发生变化，可以检查出误码；
   > > 2. 如果有偶数个位发生误码，则奇偶性不发生变化，不能检查出误码

2. 循环冗余校验CRC
   ![image-20230714142329654](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714142329654.png)

   1. **做除法的意思是，做异或运算**

## 可靠传输的实现机制

### 停止-等待协议（SW）

> 属于自动请求重传协议（ARQ）

![image-20230714151117181](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714151117181.png)

1. 接收端检测到数据分组有误码时，将其丢弃并等待发送方的超时重传。
   但对于误码率较高的点对点链路，为使发送方尽早重传，也可给发送方发送NAK分组。
2. 为了让接收方能够判断所收到的数据分组是否是重复的，需要给数据分组编号。
   由于停止-等待协议的停等特性，只需1个比特编号就够了，即编号0和1
3. 为了让发送方能够判断所收到的ACK分组是否是重复的，需要给ACK分组编号，所用比特数量与数据分组编号所用比特数量一样。
   数据链路层一般不会出现ACK分组迟到的情况，因此在数据链路层实现停止-等待协议可以不用给ACK分组编号。
4. 超时计时器设置的重传时间应仔细选择。一般可将重传时间选为略大于“从发送方到接收方的平均往返时间”
5. 当往返时延RTT远大于数据帧发送时延TD时（例如使用卫星链路），信道利用率非常低。
   若出现重传，则对于传送有用的数据信息来说，信道利用率还要降低。
6. 为了克服停止-等待协议信道利用率很低的缺点，就产生了另外两种协议，
   即后退N帧协议GBN和选择重传协议SR。

### 回退N帧协议（GBN）

> 是一种滑动窗口协议

![image-20230714153916944](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714153916944.png)

### 选择重传协议SR

![image-20230714174218114](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714174218114.png)

## 点对点协议（PPP）

### 帧格式

![image-20230714175332853](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714175332853.png)

### PPP协议的工作状态

![image-20230714180117865](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714180117865.png)

### 透明传输

#### 面向字节的异步链路采用插入转义字符的字节填充法

![image-20230714181846312](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714181846312.png)

#### 面向比特的同步链路采用插入比特0的比特填充法

![image-20230714182002819](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714182002819.png)

## 媒体接入控制（MAC）

> 共享信道要着重考虑的一个问题就是如何协调多个发送和接收站点对一个共享传输媒体的占用，
> 即媒体接入控制MAC(Medium Access Control)。

#### 静态划分信道

1. 信道复用技术

   1. 频分复用（FDM）
      ![image-20230714211540851](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714211540851.png)

   2. 时分复用（TDM）
      ![image-20230714211713302](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714211713302.png)

   3. 波分复用（WDM）

      ![image-20230714212219798](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714212219798.png)

   4. 码分复用

      > 1. CDM的每一个用户可以在同样的时间使用同样的频带进行通信。
      > 2. 由于各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。

      1. 在CDMA中，每一个比特时间再划分为m个短的间隔，称为码片(Chip)。
         通常m的值是64或128

      2. 使用CDMA的每一个站被指派一个唯一的码片码片序列

         一个站如果要发送比特1，则发送它自己的码片码片序列；

         一个站如果要发送比特0，则发送它自己的码片序列的二进制反码

      3. 码片序列挑选原则

         > 1.分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列。
         > 2.分配给每个站的码片序列必须相互正交（规格化内积为0）
         > $$
         > A \bullet B = \frac{1}{m} \times \sum_{i=1}^{m}A_i \times B_i
         > $$
         > 

#### 动态接入控制——随机接入

1. CSMA/CD协议

   > 载波监听 多址接入 / 碰撞检测
   
   1. 工作原理
      ![image-20230714235507137](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230714235507137.png)

   2. 争用期（碰撞窗口）
   
      1. 发送帧的主机最多经过以太网端到端往返传播时延2τ这么长时间，
         就可检测到本次传输是否发生了碰撞，2τ称为争用期：
      2. 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
      3. 以太网规定2τ的取值为512比特时间（即发送512比特所耗费的时间），
         对于10Mbps的以太网，2τ 即为51.2 μs。

   3. 最小帧长
   
      > $$
      > 最小帧长 = 争用期 \times 数据传输速率（带宽）
      > $$
      >
      > 最小帧长的设置是因为源主机将帧发送完毕以后，便不会再管这个帧，此时发生碰撞导致目标主机丢弃该帧，不会重发。

   4. 最大帧长

      > 最大帧长的设置是因为不能使某个主机长时间独占共享媒介，否则过于影响其它主机的数据发送

   5. 截断二进制指数退避算法
   
      > $$
      > 随机退避时间=争用期\times 随机数r,\\其中r从离散的整数集合0,1，…，(2k.1)中随机取出一个，\\
      > k = Min(重传次数，10)
      > $$
      >
      > 当重传达16次仍不能成功时，这表明同时打算发送数据的主机太多以至于连续发生碰撞，则丢弃该帧并向高层报告。
   
   6. 以太网信道利用率
      ![image-20230715002311667](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715002311667.png)
   
      理想情况公式：
      $$
      S_{max} = \frac{T_0}{T_0 + \tau} = \frac{1}{1+\frac{\tau}{T_0}}
      $$
   
      1. 信道利用率受传播时延限制，所以以太网端到端的距离收到限制
      2. 以太网帧的长度最好尽量长些

2. CSMA/CA协议

   > 载波监听 多址接入  / 碰撞避免 
   >
   > 无法在无线局域网中使用碰撞检测，所以还使用了停止-等待协议来实现可靠传输

   1. 短帧间间隔（SIFS）和 长时间间隔（DIFS）

      > 28us和 128us
      >
      > 802.11标准规定，所有的站在完成发送后，必须再等待一段帧间间隔时间才能发送下一帧。
      > 帧间间隔的长短取决于该站要发送的帧的优先级。

   2. 退避算法

      1. 在执行退避算法时，站点为退避计时器设置一个随机的退避时间
         1. 当退避计时器的时间减小到零时，就开始发送数据；
         2. 当退避计时器的时间还未减小到零时而信道又转变为忙状态，这时就冻结退避计时
            器的数值，重新等待信道变为空闲，再经过时间DIFS后，继续启动退避计时器。
      2. 在进行第i次退避时，退避时间在时隙编号0,1,......,2^i+2^ -1中随机选择一个，
         然后乘以基本退避时间（也就是一个时隙的长度）就可以得到随机的退避时间。
         这样做是为了使不同站点选择相同退避时间的概率减少。当时隙编号达到255时（对应于第6次退避)就不再增加了。

   3. 何时执行退避算法

      1. 在发送数据帧之前检测到信道处于忙状态时
      2. 在每一次重传一个数据帧时
      3. 在每一次成功发送后要连续发送下一个帧时（这是为了避免一个站点长时间占用信道）

      ![image-20230715143037936](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715143037936.png)

   4. 信道预约

      > 为了尽可能减少碰撞的概率和降低碰撞的影响，802.11标准允许要发送数据的站点对信道进行预约。
      >
      > 802.11标准允许要发送数据的站点对信道进行预约，
      > 即在发送数据帧之前先发送请求发送RTS帧。在收到响应允许发送CTS帧后，就可发送数据帧。

      1. 除源站和目的站以外的其他各站，在收到CTS帧（或数据帧）后就推迟接入到无线局域网中。这样就保证了源站和目的站之间的通信不会受到其他站的干扰。
      2. 如果RTS帧发生碰撞，源站就收不到CTS帧，**需执行退避算法重传RTS帧。**
      3. 由于RTS帧和CTS帧很短，发送碰撞的概率、碰撞产生的开销及本身的开销都很小。而对于一般的数据帧，其**发送时延往往大于传播时延**（因为是局域网），碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，
         因此用很小的代价对信道进行预约往往是值得的。802.11标准规定了3种情况供用户选择：
         1. 使用RTS帧和CTS帧
         2. 不使用RTS帧和CTS帧
         3. 只有当数据帧的长度超过某一数值时才使用RTS帧和CTS帧

      ![image-20230715143234929](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715143234929.png)

   5. 虚拟载波监听

      > 除RTS帧和CTS帧会携带通信需要持续的时间，
      > 数据帧也能携带通信需要持续的时间，这称为802.11的虚拟载波监听机制。

      1. 由于利用虚拟载波监听机制，站点只要监听到RTS帧、CTS帧或数据帧中的任何一个，
         就能知道信道被占用的持续时间
         而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题。
         ![image-20230715141954265](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715141954265.png)

## MAC地址，IP地址，ARP地址

### MAC地址

> 又称硬件地址，物理地址，属于数据链路层范畴
>
> 当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，
> 则每个主机都必须有一个唯一的标识，即一个数据链路层地址

1. 一般情况下，用户主机会包含两个网络适配器：有线局域网适配器（有线网卡）和无线局域网适配器（无线
   网卡)。
2. 每个网络适配器都有一个全球唯一的MAC地址。而交换机和路由器往往拥有更多的网络接口，所以
   会拥有更多的MAC地址。
   综上所述，严格来说，MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。

![image-20230715150633156](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715150633156.png)

![image-20230715161401308](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715161401308.png)

![image-20230715161424402](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715161424402.png)

### IP地址

> IP地址是因特网(Internet)上的主机和路由器所使用的地址，属于网络层范畴
>
> 用于标识两部分信息：
>
> 1. 网络编号：标识因特网上数以百万计的网络
> 2. 主机编号：标识同一网络上不同主机（或路由器各接口）

1. 数据包转发过程中，
   源IP地址和目的IP地址不变

   源MAC地址和目的MAC地址逐个链路改变

### ARP协议

> 解析IP地址 得到相应的MAC地址，属于网络层范畴

1. 内容步骤
   1. 源主机在自己的ARP高速缓存表中查找目的主机的1P地址所对应的MAC地址，
      若找到了，则可以封装MAC帧进行发送；
      若找不到，则发送ARP请求（封装在广播MAC帧中）
   2. 目的主机收到ARP请求后，将源主机的IP地址与MAC地址记录到自己的ARP高速缓存表中，
      然后给源主机发送ARP响应（封装在单播MAC帧中)，ARP响应中包含有目的主机的IP地址和MAC地址

2. 作用范围

   逐段链路或逐段网络使用

3. ARP高速缓存表中记录了每个IP地址对应的MAC地址，以及这个地址对的类型
   类型分为静态类型和动态类型

   1. 静态类型手动配置，可设置系统重启后这些静态类型的地址对是否仍然有效
   2. 动态类型是通过上述ARP请求以及ARP相应得到的，有效时间很短，2分钟左右

## 集线器（HUB）和交换机（SWITCH）的区别

> 前提：交换机已完成自学习

![image-20230715211429250](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230715211429250.png)

1. 交换机性能远超集线器，而且价格不高，所以市场上集线器已被淘汰
2. 交换机不会改变源目MAC地址
3. 交换机全双工传输
4. 交换机即插即用

## 以太网自学习和转发帧

1. 收到帧后进行登记。登记的内容为帧的源MAC地址及进入交换机的接口号
2. 根据帧的目的MAC地址和交换机的帧交换表对帧进行转发，有以下三种情况：
   1. 明确转发：交换机知道应当从哪个（回或哪些）接口转发该帧（单播，多播，广播）
   2. 盲目转发：交换机不知道应当从哪个端口转发帧，只能将其通过除进入交换机的
      接口外的其他所有接口转发（也称为泛洪）
   3. 明确丢弃：交换机知道不应该转发该帧，将其丢弃。
      比如：源MAC地址和目的MAC地址在表中记录为同一个端口
3. 帧交换表中的每条记录都有自己的有效时间，到期删除。原因如下：
   1. 交换机的接口改接了另一台主机
   2. 主机更换了网卡

## 以太网交换机的生成树协议STP

> 为提高以太网的可靠性，需要添加冗余链路，但添加冗余链路会形成网络环路，
> 网络环路会造成很多问题：
>
> 1. 广播风暴
>    大量消耗网络资源，使得网络无法正常转发其他数据帧：
> 2. 主机收到重复的广播帧
>    大量消耗主机资源
> 3. 交换机的帧交换表震荡（漂移）
>    某记录在错误的记录之间来回震荡
>
> STP正是为了解决这一问题而出现。
>
> 1. 不论交换机之间采用怎样的物理连接，交换机都能够自动计算并构建一个逻
>    辑上没有环路的网络，其逻辑拓扑结构必须是树型的（无逻辑环路）
> 2. 最终生成的树型逻辑拓扑要确保连通整个网络。
> 3. 当首次连接交换机或网络物理拓扑发生变化时（有可能是人为改变或故障），
>    交换机都将进行生成树的重新计算。

## 虚拟局域网（VLAN）

> 虚拟局域网是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求。
> 即作用是像路由器一样分割广播域。

1. 802.1Q帧对以太网帧进行了扩展，插入了4字节的VLAN标记
   <img src="https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716002011945.png" alt="image-20230716002011945" style="zoom: 200%;" />

2. VLAN标记的最后12比特称为VLAN标识符VID,它唯一地标志了以太网帧属于哪一个VLAN.

   1. V1D的取值范围是0~4095 ( 0 ~ 2^12^-1 )
   2. 0和4095都不用来表示VLAN，因此用于表示VLAN的V1D的有效取值范围是1~4094

3. 802.1Q帧是由交换机来处理的，而不是用户主机来处理的。

   1. 当交换机收到普通的以太网帧时，会将其**插入4字节的VLAN标记**转变为802.1Q帧，简称“打标签”
   2. 当交换机转发802.1Q帧时，可能会**删除其4字节VLAN标记**转变为普通以太网帧，简称“去标签”

4. 交换机有三种端口类型

   1. Access
   2. Trunk
   3. Hybrid

   ![image-20230716002402681](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716002402681.png)

# 网络层

> 网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输
> 要实现网络层任务，需要解决以下主要问题：
>
> 1. 网络层向运输层提供怎样的服务（可靠传输 还是 不可靠传输）
>
>    > 如果网络层对传输错误（分组丢失，分组失序等）不采取任何措施，那么就是不可靠服务
>    >
>    > TCP/IP网络体系结构提供的就是无连接，不可靠的传输服务
>
> 2. 网络层寻址问题
>
> 3. 路由选择问题

## 两种服务

![image-20230716133452655](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716133452655.png)

## IPv4地址

> 给因特网上的每一台主机（或路由器）的每一个接口分配一个在全世界范围内是唯一的32比特的标识符。

### 十进制表示

>  32比特的1Pv4地址不方便阅读、记录以及输入等，因此IPv4地址采用点分十进制表示方法以方便用户使用。
>
> 八位一组，中间用  `. ` 隔开

![image-20230716135419296](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716135419296.png)

### 分类编址的IPv4地址

![image-20230716142505440](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716142505440.png)

![image-20230716142540603](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716142540603.png)

![image-20230716142559662](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716142559662.png)

![image-20230716141719165](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716141719165.png)

### 划分子网的IPv4地址

> 从主机号中借用一部分比特来作为子网号
>
> 子网掩码
>
> > 1. 子网掩码使用连续的比特1来对应网络号和子网号
> > 2. 子网掩码使用连续的比特0来对应主机号

![image-20230716165915602](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716165915602.png)

1. 为新增网络申请新的网络号会带来以下弊端：
   1. 需要等待时间和花费更多的费用
   2. 会增加其他路由器中路由表记录的数量
   3. 浪费原有网络号中剩余的大量IP地址
2. 默认子网掩码
   ![image-20230716170001375](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716170001375.png)

### 无分类编址的IPv4地址

> 无分类域间路由选择（CIDR）消除了传统的A类、B类和C类地址，以及划分子网的概念。
> CIDR可以更加有效地分配IPV4的地址空间，并且可以在新的PV6使用之前允许因特网的规模继续增长。
> 如：192.8.32.3/ 20

1. 路由聚合
   构造超网，找到相同接口的多个地址的最长公共前缀，其余位归0，将该地址记录下来，那些地址删除
   即将它们合并成一个地址

   > 网络前缀越长，地址块越小，路由越具体

   > 若路由器查表转发分组时发现有多条路由可选，则选择网络前缀最长的那条，这称为最长前缀匹配。
   > 因为这样的路由更具体

### IPv4地址的应用规划

![image-20230716214234227](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716214234227.png)

1. 变长的子网掩码是CIDR技术的应用

### IP数据报发送和转发过程

> 分为两部分
>
> 1. 主机发送IP数据报
> 2. 路由器发送IP数据报

1. 主机发送数据报
   ![image-20230716231831637](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716231831637.png)

2. 路由器转发数据报
   ![image-20230716231842529](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230716231842529.png)

### 静态路由配置及其可能产生的路由环路问题

> 静态路由配置是指用户或网络管理员使用路由器的相关命令给路由器人工配置路由表。
>
> 1. 这种人工配置方式简单、开销小。但不能及时适应网络状态（流量、拓扑等）的变化。
> 2. 一般只在小规模网络中采用。

1. 使用静态路由配置可能出现以下导致产生路由环路的错误

   1. 配置错误

      > 解决方法：
      > IP数据报头部设置一个生存期，每经过一次路由转发，其值减一，当其值小于等于0时被丢弃

   2. 聚合了不存在的网络

      > 静态配置不存在的IP网络为黑洞路由

   3. 网络故障

      > 静态配置故障的IP网络为黑洞路由，当其故障修复后，再自动添加回来并设置黑洞路由无效，
      > 若再故障，则删除并设置之前的黑洞路由有效

2. 路由条目的类型
   1. 直连网络
   2. 静态路由（人工配置）
   3. 动态路由（路由选择协议）

3. 特殊的静态路由条目

1. 默认路由（目的网络为0.0.0.0，地址掩码为0.0.0.0）

   > 当路由表查找不到目标网络时，使用该路由

2. 特定主机路由（目的网络为特定主机的1P地址，地址掩码为255.255.255.255）

3. 黑洞路由（下一跳为null0)

## 路由选择协议

> 早期RFC文档中，使用“网关”这个词指代路由器，现代使用“路由器”指代路由器，两者为同一设备的不同名称

1. 静态路由选择
   1. 由人工配置的网络路由、默认路由、特定主机路由，黑洞路由等都属于静态路由。
   2. 这种人工配置方式简单、开销小，
      但不能及时适应网络状态（流量、拓扑等）的变化
   3. 一般只在小规模网络中采用。
2. 动态路由选择
   1. 路由器通过路由选择协议自动获取路由信息
      比较复杂、开销比较大，
   2. 能较好地适应网络状态的变化
   3. 适用于大规模网络
3. 因特网采用分层次的路由选择协议
   ![image-20230717142740402](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717142740402.png)
   1. 一般一个ISP负责的所有网络作为一个自治系统
   2. 内部网关协议（IGP）和外部网关协议（EGP）是协议分类的总称，不是具体的协议名
4. 路由选择协议
   ![image-20230717142826429](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717142826429.png)

### 路由信息RIP协议工作原理

> 1. RIP要求自治系统AS内的每一个路由器都要维护从它自己到AS内其他每一个网络的距离记录。
>    这是一组距离，称为“距离向量”。
> 2. RIP使用跳数(Hop Count)作为度量(Metric)来衡量到达目的网络的距离。
> 3. RP认为好的路由就是“距离短”的路由，也就是所通过路由器数量最少的路由
> 4. 当到达同一目的网络有多条“距离相等”的路由时，可以进行等价负载均衡

1. 特点

   1. 仅和相邻路由器交换信息
   2. 交换的信息是自己的路由表
   3. 周期性交换该信息

2. RP的基本工作流程

   1. 路由器刚开始工作时，只知道自己到直连网络的距离为1。
   2. 每个路由器仅和相邻路由器周期性地交换并更新路由信息。
   3. 若干次交换和更新后，每个路由器都知道到达本AS内各网络的最短距离和下一跳地址，称为收敛。

3. 更新规则

   1. 发现了新的网络，添加
   2. 到达目的网络，相同下一跳，最新消息，更新
   3. 到达目的网络，不同下一跳，新路由优势，更新
   4. 到达目的网络，不同下一跳，新路由劣势，不更新
   5. 到达目的网络，不同下一跳，等价负载均衡

4. RIP存在“坏消息传播得慢”的问题

   > 坏消息传播得慢”又称为路由环路或距离无穷计数问题，这是距离向量算法的一个固有问题。

   可以采取多种措施减少出现该问题的概率或减小该问题带来的危害。

   1. 限制最大路径距离为15(16表示不可达)
   2. 当路由表发生变化时就立即发送更新报文（即“触发更新”），而不仅是周期性发送
   3. 让路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送（即“水平分割”）

### 开放最短路径OSPF协议的工作原理

> 1. OSPF是基于链路状态的，而不像RIP那样是基于距离向量的。
> 2. OSPF不限制网络规模，更新效率高，收敛速度快。
> 3. “最短路径优先”是因为使用了Dijkstra提出的最短路径算法SPF
>    OSPF采用SPF算法计算路由，从算法上保证了不会产生路由环路。

1. 链路状态是指本路由器都和哪些路由器相邻，以及相应链路的“代价”(cost)。

   > “代价”用来表示费用、距离、时延、带宽，等等。这些都由网络管理人员来决定。 

2. 使用OSPF的每个路由器都会产生链路状态通告 LSA  (Link State Advertisement)。

   1. LSA中包含以下内容：
      1. 直连网络的链路状态信息
      2. 邻居路由器的链路状态信息
   2. LSA被封装在链路状态更新分组LSU中，采用洪泛法发送。
      使用OSPF的每个路由器都有一个链路状态数据库LSDB，用于存储LSA。
   3. 通过各路由器洪泛发送封装有自己LSA的LSU分组，各路由器的LSDB最终将达到一致。
   4. 使用OSPF的各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表。

3. OSPF共有五种分组类型

   1. 问候分组（Hello）
   2. 数据库描述分组（DD）
   3. 链路状态请求分组（LSR）
   4. 链路状态更新分组（LSU）
   5. 链路确认分组（LSA）

   ![image-20230717155343654](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717155343654.png)

   ![image-20230717155522453](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717155522453.png)

4. OSPF在多点接入的网络中路由器邻里关系的建立

   1. 选举指定路由器DR(designated router)和备用的指定路由器BDR(backup designated router)
   2. 所有的非DR/BDR只与DR/BDR建立邻居关系，即非DR/BDR之间通过DR/BDR交换信息

   ![image-20230717155708575](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717155708575.png)

5. 为了使OSPF能够用于规模很大的网络，OSPF把一个自治系统再划分为若干个更小的范围，叫做区域(Area)

   > 划分区域的好处就是把利用洪泛法交换链路状体信息的范围局限于每一个区域而不是整个自治系统，
   > 这就减少了整个网络上的通信量。

   ![image-20230717155224878](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717155224878.png)

### 边界网关协议BGP的基本工作原理

> BGP只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
>
> BGP要解决的问题
>
> 1. 在不同自治系统内，度量路由的“代价”（距离，带宽，费用等)可能不同。
>    因此，对于自治系统之间的路由选择，使用“代价”作为度量来寻找最佳路由是不行的。
> 2. 自治系统之间的路由选择必须考虑相关策略（政治，经济，安全等）

1. 交换路由的过程

   1. 在此TCP连接上交换BGP报文以建立BGP会话

   2. 利用BGP会话交换路由信息（例如，增加新的路由，或撤销过时的路由，以及报告出错的情况等）

      > 使用TCP连接交换路由信息的两个BGP发言人，彼此称为对方的邻站(neighbor)或对等站(peer)

   3. 当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信
      息中找出到达各自治系统的较好的路由。也就是构造出树形结构、不存在回路的自治系统连通图。

2. BGP-4四种报文类型

   |          报文          | 说明                                              |
   | :--------------------: | :------------------------------------------------ |
   |     OPEN(打开)报文     | 用来与相邻的另一个BGP发言人建立关系，使通信初始化 |
   |    UPDATE(更新)报文    | 用来通告某一路由的信息，以及列出要撤销的多条路由  |
   |  KEEPALIVE(保活)报文   | 用来周期性地证实邻站的连通性。                    |
   | NOTIFICATION(通知)报文 | 用来发送检测到的差错。                            |

## IP数据报的首部格式

![image-20230717175105117](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717175105117.png)

| 字段                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| 版本                 | 占4比特，表示IP协议的版本。<br />通信双方使用的P协议的版本必须一致。<br />目前广泛使用的IP协议版本号为4（即IPv4)<br/> |
| 首部长度<br/>        | 占4比特，表示IP数据报首部的长度。<br />该字段的取值以4字节为单位。<br />最小十进制取值为5，表示P数据报首部只有20字节固定部分；<br/>量大十进制取值为15，表示1P数据报首部包含20字节固定部分和最大40字节可变部分。<br/> |
| 区分服务             | 占8比特，用来获得更好的服务。利用该字段的不同数值可提供不同等级的服务质量。<br />只有在使用区分服务时，该字段才起作用。一般情况下都不使用该字段。 |
| 总长度               | 占16比特，表示IP数据报的总长度（首部+数据载荷），最大取值为十进制的65535，以字节为单位。 |
| 标识                 | 占16比特，属于同一个数据报的各分片数据报应该具有相同的标识。<br />IP软件维持一个计数器，每产生一个数据报，计数器值加1，并将此值赋给标识字段。 |
| 标志                 | 占3比特，各比特含义如下：<br />DF位：1表示不允许分片：0表示允许分片；<br />MF位：1表示 后面还有分片：0表示 这是最后一个分片；<br />保留位：必须为0 |
| 片偏移               | 占13比特，指出分片数据报的数据载荷部分偏移其在原数据报的位置有多少个单位。<br />片偏移以8个字节为单位。 |
| 生存时间TTL          | 占8比特，表示P数据报的生存时间。<br />现在以“跳数”为单位，路由器转发P数据报时，将1P数据报首部中的该字段的值减1，若不为0就转发。否则就丢弃 |
| 首部校验和           | 1P数据报每经过一个路由器，路由器都要重新计算首部检验和，因为某些字段<br />（生存时间，标志，片偏移等）的取值可能发生变化 |
| 源IP地址和目的IP地址 | 略                                                           |
| 填充                 | IP数据报首部大小必须为4字节的整数倍                          |
| 可选字段长度         | 从1个字节到40个字节不等。用来支持排错、测量及安全等措施<br />但一般不使用 |
|                      |                                                              |

## 网际控制报文协议ICMP

> 为了更有效地转发P数据报和提高交付成功的机会，在网际层使用了网际控制报文协议
>
> 1. 主机或路由器使用ICMP来发送差错报告报文和询问报文
> 2. ICMP报文被封装在IP数据报中发送

1. 共有五种差错报告报文

   1. 终点不可达
   2. 源点抑制
   3. 时间超过
   4. 参数问题
   5. 改变路由(重定向)

2. 当发生以下情况时不应该发送IMCP差错报告报文

   1. 对ICMP差错报告报文不再发送ICMP差错报告报文
   2. 对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文
   3. 对具有多播地址的数据报都不发送ICMP差错报告报文
   4. 对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报不发送1CMP差错报告报文

3. 常用的ICMP询问报文有以下两种：

   1. 回送请求和回答

      > 1. ICMP回送请求报文是由主机回或路由器向一个特定的目的主机发出的询问，
      > 2. 收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。
      >    这种询问报文用来测试目的站是否可达及了解其有关状态。

   2. 时间戳请求和回答

      > 1. ICMP时间戳请求报文是请某个主机或路由器回答当前的日期和时间。
      > 2. 在ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。

4. ICMP应用

   1. 分组网间探测（PING）

      > Packet Internet Groper

      1. 用来测试主机或路由器间的连通性
      2. 应用层直接使用网际层的ICMP(没有通过运输层的TCP或UDP)
      3. 使用ICMP回送请求和回答报文

   2. 跟踪路由

      > traceroute
      >
      > 用来测试P数据报从源主机到达目的主机要经过哪些路由器

      1. Windows版本

         > tracert命令
         > 应用层直接使用网际层ICMP
         > 使用了ICMP回送请求和回答报文以及差错报告报文

      2. Unix版本

         > traceroute命令
         > 在运输层使用UDP协议
         > 仅使用ICMP差错报告报文

## 虚拟专用网络VPN与网络地址转换NAT

### VPN

> 利用公用的因特网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网。
>
> VPN要保证传输数据的安全性，会将原始的内部数据报进行加密，
> 然后再将其封装成为在因特网上发送到的外部数据报。

![image-20230717222834041](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717222834041.png)

![image-20230717223451602](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717223451602.png)

1. VPN类型
   1. 同一机构内不同部门的内部网络所构成的虚拟专用网VPN又称为内联网VPN
   2. 有时一个机构的VPN需要有某些外部机构（通常就是合作伙伴）参加进来。这样的VPN就称为外联网VPN
   3. 在外地工作的员工需要访问公司内部的专用网络时，只要在任何地点接入到因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，即可访问专用网络中的资源。这种VPN称为远程接入VPN。

### NAT

> NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源。
>
> 传统NAT是将每个本地IP转换为一个公有IP，意味着路由器中NAT映射表记录N个全球IP，则对应的子网最多只能有N台主机，这不符预期。

1. 由于绝大多数的网络应用都是使用运输层协议TCP或UDP来传送数据，因此可以利用运输层的端口号和IP地址一起进行转换。
   这样用一个全球P地址就可以使多个拥有本地地址的主机同时和因特网上的主机进行通信。这种将端口号和P地址一起进行转换的技术叫作网络地址与端口号转换NAPT (Network Address and Port Translation)。

   ![image-20230717223653512](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717223653512.png)

2. 对于一些P2P网络应用，需要外网主机主动与内网主机进行通信，在通过NAT时会遇到问题，需要网络应用自己使用一些特殊的NAT穿越技术来解决问题。

3. 由于NAT对外网屏蔽了内网主机的网络地址，能为内网的主机提供一定的安全保护。

# 运输层

> 实际上在计算机网络中进行通信的真正实体是位于通信两端主机中的进程，
> 如何为运行在不同主机上的应用进程提供直接的通信服务是运输层的任务，运输层协议又称为端到端协议。
>
> 根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输协议，
> 即面向连接的TCP和无连接的UDP,这两种协议就是本章要讨论的主要内容。

## 运输层端口号，复用，分用

### 端口号

> 1. 用来区分应用层的不同应用进程，端口号使用16比特表示，取值范围 [0,65535]。
>
> > 因为因特网上的计算机并不是使用统一的操作系统，不同的操作系统又使用不同格式的进程标识符，
> > 为了使运行不同操作系统的计算机的应用进程之间能够进行网络通信，就必须使用统一的方法对
> > TCP八P体系的应用进程进行标识。
>
> 2. 端口号只具有本地意义，即端口号只是为了标识本计算机应用层中的各进程，
>    在因特网中，不同计算机中的相同端口号是没有联系的。

1. 端口号的划分
   ![image-20230717225154310](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717225154310.png)

### 发送方的复用和接收方的分用

![image-20230717225454198](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717225454198.png)

1. TCP/IP体系的应用层常用协议所使用运输层的熟知端口号
   ![image-20230717225756545](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230717225756545.png)

## UDP与TCP的对比

![1689607593271](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/1689607593271.png)

## TCP流量控制

> 1. 所谓流量控制 ( flow control )就是让发送方的发送速率不要太快，要让接收方来得及接收。
>
> 2. TCP接收方利用自己的接收窗口的大小来限制发送方发送窗口的大小。
>
> $$
> 发送窗口 = Min(发送方拥塞窗口，接受方接收窗口)
> $$

1. 注意

   1. TCP发送方收到接收方的零窗口通知后，应启动持续计时器。
      持续计时器超时后，向接收方发送零窗口探测报文。

      > 若是零窗口探测报文传输过程中丢失，则在其重发计数器超时后重发该报文

## TCP拥塞控制

![image-20230718152947507](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718152947507.png)

1. 慢开始与拥塞避免算法

   1. 发送方维护一个叫做拥塞窗口cwd的状态变量，其值取决于网络的拥塞程度，并且动态变化。

      1. 拥塞窗口cwd的维护原则

         > 只要网络没有出现拥塞，拥塞窗口就再增大一些；
         > 但只要网络出现拥塞，拥塞窗口就减少一些。
         >
         > > 具体做法
         > >
         > > 1. 发生超时重传后，将门限ssthresh设为拥塞窗口的一半，并将当前拥塞窗口设为1
         > > 2. 重新运行开始慢开始算法

      2. 判断出现网络拥塞的依据

         > 没有按时收到应当到达的确认报文（即发生超时重传）。

   2. 发送方将拥塞窗口作为发送窗口swnd,即 swnd=cwnd。

   3. 维护一个慢开始门限ssthresh状态变量

      1. 当cwnd<ssthresh时，使用慢开始算法
      2. 当cwnd>ssthresh时，停止使用慢开始算法而改用拥塞避免算法：
      3. 当cwnd=ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法。

2. 快重传与快恢复

   1. 要求接收方不要等待自己发送数据时才进行消带确认，而是要立即发送确认

   2. 即使收到了失序的报文段也要立即发出对已收到的报文段的重复确认。

   3. 发送方一旦**收到3个连续的重复确认**，就将相应的报文段立即重传，
      而不是等该报文段的超时重传计时器超时再重传。

   4. 发送方一旦收到3个重复确认，就知道现在只是丢失了个别的报文段。
      于是不启动慢开始算法，而执行**快恢复算法**

      1. 发送方将慢开始**门限ssthresh值**和**拥塞窗口cwnd值**调整为**当前窗口的一半**

      2. 开始执行拥塞避免算法。

         > 也有的快恢复实现是把快恢复开始时的拥塞窗口cwnd值再增大一些，
         > 即等于新的ssthresh+3。
         >
         > > 既然发送方收到3个重复的确认，就表明有3个数据报文段已经离开了网络，
         > > 这3个报文段不再消耗网络资源而是停留在接收方的接收缓存中，
         > > 可见现在网络中不是堆积了报文段而是减少了3个报文段。
         > > 因此可以适当把拥塞窗口扩大些。

   ![image-20230718155219032](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718155219032.png)

## TCP超时重传的时间的选择（RTO）

> 利用每次测量得到的RTT样本，计算加权平均往返时间RTTs(又称为平滑的往返时间)。
> 超时重传的时间应略大于RTTs的值。

1. 计算RTT~S~
   $$
   初始RTT_S = 测得的第一个RTT
   \\RTTs = (1-\alpha)\times 旧的RTTs + \alpha \times 新的RTT样本
   $$
   建议 $\alpha$ = 0.125

2. 计算RTT~D~
   $$
   初始RTT_D = \frac{RTT_1}{2}\\
   RTT_D = (1 - \beta) \times 旧的RTT_D + \beta \times \vert RTT_S - 新的RTT样本 \vert
   $$
   建议$\beta$ = 0.25

3. 计算超时重传时间
   $$
   RTO = RTT_S + 4 \times RTT_D
   $$
   只要某报文段超时重传，就将RTO设为原来的两倍，而不是按照上述公式计算

## TCP可靠传输的实现

1. TCP基于以字节为单位的滑动窗口来实现可靠传输。

   1. 发送方在未收到接收方的确认时，可将发送窗口内还未发送的数据全部发送出去

   2. 接收方只接收序号落入发送窗口内的数据

      > 虽然发送方的发送窗口是根据接收方的接收窗口设置的，
      > 但在同一时刻，发送方的发送窗口并不总是和接收方的接收窗口一样大。

   3. 网络传送窗口值需要经历一定的时间滞后，井且这个时间还是不确定的。

   4. 发送方还可能根据网络当时的拥塞情况适当减小自己的发送窗口尺寸

2. 对于不按序到达的数据应如何处理，TCP并无明确规定

   1. 如果接收方把不按序到达的数据一律丢弃，那么接收窗口的管理将会比较简单，
      但这样做对网络资源的利用不利，因为发送方会重复传送较多的数据。
   2. TCP通常对不按序到达的数据是先临时存放在接收窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程
   3. TCP要求接收方必须有累积确认和捎带确认机制，这样可以减小传输开销。接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。
      1. 接收方不应过分推迟发送确认，否则会导致发送方不必要的超时重传，这反而浪费了网络的资源。
      2. TCP标准规定，确认推迟的时间不应超过0.5秒。若收到一连串具有最大长度的报文段，则必须每隔一个报文段就发送一个确认
      3. 梢带确认实际上并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据。

3. TCP的通信是全双工通信。

   > 通信中的每一方都在发送和接收报文段。
   > 因此，每一方都有自己的发送窗口和接收窗口。在谈到这些窗口时，一定要弄清楚是哪一方的窗口。

## TCP的连接建立（三次握手）

> TCP的连接建立要解决以下三个问题：
>
> 1. 使TCP双方能够确知对方的存在
> 2. 使TCP双方能够协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等）
> 3. 使TCP双方能够对运输实体资源（如缓存大小、连接表中的项目等）进行分配。

1. 三次握手建立连接的过程

   > 也就是使用三个TCP报文建立连接

   ![image-20230718175005023](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718175005023.png)

2. 两报文建立连接会发生以下问题
   ![image-20230718175045894](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718175045894.png)

## TCP的连接释放（四次挥手）

1. 四报文挥手过程
   ![image-20230718182458129](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718182458129.png)

2. 若不等待2MSL则有可能发生以下情况

   > 最后一个确认报文丢失，导致服务器进程陷入最后确定状态，无法进入关闭状态

   ![image-20230718182524772](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718182524772.png)

## TCP报文段的首部格式

![image-20230718214219357](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718214219357.png)

| 字段          | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| 源端口        | 占16比特，写入源端口号，用来标识发送该TCP报文段的应用进程    |
| 目的端口      | 占16比特，写入目的端口号，用来标识接收该TCP报文段的应用进程  |
| 序号          | 占32比特，取值范围[0,2^32^-1]，序号增加到最后一个后，下一个序号就又回到0。<br/>指出本TCP报文段数据载荷的第一个字节的序号。 |
| 确认号        | 占32比特，取值范围[0,2^32^-1]，确认号增加到最后一个后，下一个确认号就又回到0。<br/>指出期望收到对方下一个TCP报文段的数据载荷的第一个字节的序号，同时也是对之前收到的所有数据的确认。 |
| 确认标志位ACK | 取值为1时确认号字段才有效：取值为0时确认号字段无效           |
| 数据偏移      | 占4比特，并以4字节为单位。<br/>用来指出TCP报文段的数据载荷部分的起始处距离TCP报文段的起始处有多远。 |
| 保留          | 占6比特，保留为今后使用，但目前应置为0。                     |
| 窗口          | 占16比特，以字节为单位。指出发送本报文段的一方的接收窗口。<br/>窗口值作为接收方让发送方设置其发送窗口的依据。<br/>这是以接收方的接收能力来控制发送方的发送能力，称为流量控制。 |
| 校验和        | 占16比特，检查范围包括TCP报文段的首部和数据载荷两部分。<br/>在计算校验和时，要在TCP报文段的前面加上12字节的伪首部。 |
| 同步标志位SYN | 在TCP连接建立时用来同步序号                                  |
| 终止标志位FIN | 用来释放TCP连接。                                            |
| 复位标志位RST | 用来复位TCP连接。<br/>当RST=1时，表明TCP连接出现了异常，必须释放连接，然后再重新建立连接。<br />RST置1还用来拒绝一个非法的报文段或拒绝打开一个TCP连接。 |
| 推送标志位PSH | 接收方的TCP收到该标志位为1的报文段会尽快上交应用进程。<br/>而不必等到接收缓存都填满后再向上交付。 |
| 紧急标志位URG | 取值为1时紧急指针字段有效：取值为0时紧急指针字段无效。       |
| 紧急指针      | 占16比特，以字节为单位，用来指明紧急数据的长度。[^紧急数据]  |
| 选项          | 1. 最大报文段长度MSS选项：TCP报文段数据载荷部分的最大长度。<br/>2. 窗口扩大选项：为了扩大窗口（提高吞吐率）<br/>3. 时间戳选项：<br/>     a. 用来计算往返时间RTT<br/>     b. 用于处理序号超范围的情况，又称为防止序号绕回PAWS。<br/>4. 选择确认选项<br />选项的作用是为了扩展TCP报文段首部的功能 |
| 填充          | 由于选项的长度可变，因此使用填充来确保报文段首部能被4整除<br/>(因为数据偏移字段，也就是首部长度字段，是以4字节为单位的) |

[^紧急数据]: 当发送方有紧急数据时，可将紧急数据插队到发送缓存的最前面，并立刻封装到一个TCP报文段中进行发送。紧急指针会指出本报文段数据载荷部分包含了多长的紧急数据，紧急数据之后是普通数据。接收方将紧急数据部分取出，并直接上交应用程序，而不必在接受缓存中排队。

# 应用层

![image-20230718222426373](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718222426373.png)

## 客户/服务器方式（C/S）和对等方式（P2P方式）

![image-20230718223137811](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718223137811.png)

## 动态主机配置协议DHCP

> 动态主机配置协议DHCP(Dynamic Host Configuration Protocol))提供了一种机制，称为即插即用连网。
> 这种机制允许一台计算机加入新网络时可自动获取P地址等网络配置信息而不用手工参与。

1. DHCP报文在运输层使用UDP协议封装

   1. DHCP客户使用的UDP端口号为68
   2. DHCP服务器使用的UDP端口号为67

2. 客户端向DHCP服务器申请IP的全过程

   <img src="https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718224722810.png" alt="image-20230718224722810"  />

   | 报文          | 包含字段                                                     |
   | ------------- | ------------------------------------------------------------ |
   | DHCP DISCOVER | 事务ID，DHCP的MAC地址                                        |
   | DHCP OFFER    | 事务ID，配置信息：IP地址，子网掩码，地址租期，默认网关，DNS服务器 |
   | DHCP REQUEST  | 事务ID，DHCP的MAC地址，接受的租约中的IP地址，提供此租约的DHCP服务器的IP地址 |

2. DHCP中继代理

   > 路由器不会转发普通的广播分组，并且我们也不希望在每个网络中都配置一台DHCP服务器，
   > 所以DHCP中继代理出现了。

   ![image-20230718225018393](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718225018393.png)

## 域名系统DNS

> 1. 域名系统DNS是因特网使用的命名系统，用来把便于人们记忆的具有特定含义的主机名（例如www.hust.cn),
>    转换为便于机器处理的IP地址。
>
> 2. 因特网采用层次树状结构的域名结构		…三级域名.二级域名.顶级域名
>
> 3. 域名和IP地址的映射关系必须保存在域名服务器中，供所有其他应用查询。显然不能将所有信息都储存在一台域名服务器中。DNS使用分布在各地的域名服务器来实现域名到IP地址的转换。
> 4. DNS报文使用运输层的UDP协议进行封装，运输层端口号为53

1. 域名层次划分
   1. 顶级域名
      1. 国家顶级域名
      2. 通用顶级域名
      3. 反向域（arpa）
   2. 顶级域名由ICANN管理，顶级域名以下的二级域名，三级域名等，都由其上一级域名管理机构自行管理。

2. 域名服务器四种类型划分

   1. 根域名服务器
      1. 根域名服务器是最高层次的域名服务器。
         每个根域名服务器都知道所有的顶级域名服务器的域名及其IP地址。
         因特网上共有13个不同IP地址的根域名服务器。
      2. 尽管我们将这13个根域名服务器中的每一个都视为单个的服务器，但“每台服务器”实际上是由许多分布在世界各地的计算机构成的服务器群集。当本地域名服务器向根域名服务器发出查询请求时，路由器就把查询请求报文转发到离这个DNS客户最近的一个根域名服务器。
         这就加快了DNS的查询过程，同时也更合理地利用了因特网的资源。
      3. 根域名服务器通常并不直接对域名进行解析，
         而是返回该域名所属顶级域名的顶级域名服务器的IP地址。
   2. 顶级域名服务器
      1. 这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。
         当收到DNS查询请求时就给出相应的回答
         （可能是最后的结果，也可能是下一级权限域名服务器的P地址)。
   3. 权限域名服务器
      1. 这些域名服务器负责管理某个区的域名。
         每一个主机的域名都必须在某个权限域名服务器处注册登记。
         因此权限域名服务器知道其管辖的域名与引P地址的映射关系。
      2. 另外，权限域名服务器还知道其下级域名服务器的地址
   4. 本地域名服务器
      1. 本地域名服务器不属于上述的域名服务器的等级结构。
         当一个主机发出DNS请求报文时，这个报文就首先被送往该主机的本地域名服务器。
      2. 本地域名服务器起着代理的作用，会将该报文转发到上述的域名服务器的等级结构中。
      3. 每一个因特网服务提供者ISP，一个大学一个大学里的学院，都可以拥有一个本地域名服务器，它有时也称为默认域名服务器。本地域名服务器离用户较近，一般不超过几个路由器
         的距离，也有可能就在同一个局域网中。
      4. 本地域名服务器的IP地址需要直接配置在需要域名解析的主机中，

3. DNS域名解析两种方式

   > 递归解析和迭代解析

   ![image-20230718233234205](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230718233234205.png)

4. 为了提高DNS的查询效率，并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量，
   在域名服务器和主机中广泛地使用了高速缓存。

## 文件传送协议FTP

> 1. FTP提供交互式的访问，允许客户指明文件的类型与格式（如指明是否使用ASC川码），
>    并允许文件具有存取权限（如访问文件的用户必须经过授权，并输入有效的口令）
> 2. FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件

1. 基本原理
   ![image-20230719151544230](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719151544230.png)
   1. FTP客户和服务器之间要建立以下两个并行的TCP连接
      1. 控制连接，在**整个会话期间一直保持打开**，用于传送FTP相关**控制命令**
      2. 数据连接，用于文件传输，在**每次文件传输时才建立**，**传输结束就关闭**
   2. 默认情况下，FTP使用TCP 21端口进行控制连接，TCP 20端口进行数据连接。
      但是，是否使用TCP20端口建立数据连接与传输模式有关，主动方式使用TCP 20端口
      被动方式由服务器和客户端自行协商决定。

## 电子邮件



1. 电子邮件系统

   > 电子邮件系统采用客户/服务器方式。三个主要组成构件：用户代理，邮件服务器。以及电子邮件所需的协议

   1. 用户代理是用户与电子邮件系统的接口，又称为电子邮件客户端软件
   2. 邮件服务器是电子邮件系统的基础设施。因特网上所有的SP都有邮件服务器，其功能是发送和接收邮件，同时还要负责维护用户的邮箱。
   3. 协议包括邮件发送协议（例如SMTP)和邮件读取协议（例如POP3)。

2. 电子邮件的格式

   > 一个电子邮件有信封和内容两部分。而内容又由首部和主体两部分构成。

   ![image-20230719172921933](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719172921933.png)

   1. 高亮部分为比较重要的部分，为必填项。

3. 电子邮件发送和接收的基本过程
   ![image-20230719154130901](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719154130901.png)

   1. SMTP是邮件发送协议
   2. POP3是邮件读取协议

2. 简单邮件传送协议SMTP

   1. 基本工作原理

      ![image-20230719172515380](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719172515380.png)

   2. 为解决SMTP传送非ASCII码文本的问题，提出了多用途因特网邮件扩展MIME
      ![image-20230719171940706](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719171940706.png)

3. 邮件读取协议

   1. 邮局协议POP3

      > 非常简单、功能有限的邮件读取协议。用户只能以下载并删除方式或下载并保留方式从邮件服务器下载邮件到用户方计算机。不允许用户在邮件服务器上管理自己的邮件。

   2. 因特网邮件访问协议IMAP

      > 功能比POP3强大的邮件读取协议。用户在自己的计算机上就可以操控邮件服务器中的邮箱，
      > 就像在本地操控一样，因此IMAP是一个联机协议。

   3. POP3和IMAP4都采用基于TCP连接的客户/服务器方式。
      1. POP3使用端口110 
      2. IMAP4使用端口143

4. 基于万维网的电子邮件

   > 1. 通过浏览器登录（提供用户名和口令）邮件服务器万维网网站就可以撰写、收发、阅读和管理电子邮件。这种工作模式与IMAP很类似，不同的是用户计算机无需安装专门的用户代理程序，只需要使用通用的万维网浏览器。
   > 2. 这种工作摸式在用户浏览器与邮件服务器网站之间使用HTTP协议，而邮件服务器之间使用SMTP协议。

   ![image-20230719172407736](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719172407736.png)

## 万维网WWW

> 即 World Wide Web，是一个大规模的、联机式的信息储藏所，是运行在因特网上的一个分布式应用。

1. 统一资源定位符URL

   > 万维网使用统一资源定位符URL来指明因特网上任何种类“资源”的位置。
   >
   > 其一般形式为：`<协议>：/∥<主机>：<端口>/<路径>`

2. 超文本传输协议HTTP

   > 超文本传输协议 HTTP (HyperText Transfer Protocol) 定义了浏览器（即万维网客户进程）
   > 怎样向万维网服务器请求万维网文档以及万维网服务器怎样把万维网文档传送给浏览器。

   1. HTTP1.0

      > 采用非持续连接方式。每次浏览器要请求一个文件都要与服务器建立TCP连接(80端口)，
      > 当收到响应后就立即关闭连接。

   2. HTTP1.1

      > 1. 采用持续连接方式。万维网服务器在发送响应后仍然保持这条连接，使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。
      >
      > 2. 为了进一步提高效率，还可采用流水线方式，即浏览器在收到HTTP的响应报文之前
      >    就能够连续发送多个请求报文。

3. HTTP两种报文——请求报文和响应报文

   > 报文中的每一个字段都是一些ASCII码串，并且每个字段的长度都是不确定的。

   1. 请求报文格式
      ![1689763938693](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/1689763938693.png)

   

   2. 响应报文格式
      ![1689763996008](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/1689763996008.png)

      

4. Cookie技术

   > Cookie提供了一种机制使得万维网服务器能够“记住”用户，而无需用户主动提供用户标识信息。
   > 也就是说，Cookie是一种**对无状态的HTTP进行状态化**的技术。

   ![image-20230719184205348](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719184205348.png)

5. 万维网缓存（Web缓存）

   > 在万维网中还可以使用缓存机制以提高万维网的效率。
   > 可位于客户机，也可位于中间系统上，位于中间系统上的Web缓存又称为代理服务器。

   ![image-20230719183530450](https://raw.githubusercontent.com/Ag-epiphany/typora_Pictures/main/image-20230719183530450.png)

   | 字段          | 说明         |
   | ------------- | ------------ |
   | Last-Modified | 最后修改时间 |
   | Expires       | 有效期       |

   1. 若过了最后有效期，则在客户机发来请求时，代理服务器向原始服务器发送请求得到新的数据
      1. 若原始服务器的数据也未更改，则发回一个不带实体数据的响应报文，
         代理服务器收到后更新有效期，将数据发给客户机
      2. 若原始服务器的数据更改，那么发回新数据的响应报文，代理服务器更新数据以及两个字段并将新数据发给客户机

